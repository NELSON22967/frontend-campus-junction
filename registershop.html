<!DOCTYPE html>
<html lang="en">   
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Permanent Shop Registration | Campus Marketplace</title>

<style>
body{
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
}

.shopsboard{
    height: 90px;
    font-size: 22px;
    background: linear-gradient(90deg,#007bff,#005fcc);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.form-container{
    max-width: 550px;
    margin: 40px auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}

label{
    font-weight: bold;
    display: block;
    margin-bottom: 6px;
}

input, select{
    width: 100%;
    padding: 11px;
    margin-bottom: 15px;
    border: 1px solid #bbb;
    border-radius: 6px;
    font-size: 15px;
}

input:focus, select:focus{
    border-color: #007bff;
    outline: none;
}

.image-preview{
    width: 100%;
    height: 180px;
    background: #eee;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    margin-bottom: 12px;
    color: #555;
    font-size: 14px;
    overflow: hidden;
}

.image-preview img{
    width: 100%;
    height: 100%;
    object-fit: cover;
}

button{
    width: 100%;
    padding: 13px;
    border: none;
    background: #007bff;
    color: white;
    font-size: 17px;
    border-radius: 8px;
    cursor: pointer;
}

button:disabled{
    opacity: 0.7;
    cursor: not-allowed;
}

button:hover{
    background: #005fcc;
}

.success{
    text-align: center;
    color: green;
    margin-top: 12px;
    font-weight: bold;
}

.error{
    text-align: center;
    color: red;
    margin-top: 12px;
    font-weight: bold;
}
</style>
</head>

<body>

<section class="shopsboard">
    <h1>Permanent Shop Registration</h1>
</section>

<div class="form-container">

    <div class="image-preview" id="previewBox">
        Click to upload Shop Logo
    </div>
    <input type="file" id="logoUpload" accept="image/*" hidden>

    <label>Shop Name</label>
    <input type="text" id="shopName">

    <label>Shop Description</label>
    <input type="text" id="description">

    <button id="registerBtn">Register Shop</button>

    <div class="success" id="successMsg" hidden></div>
    <div class="error" id="errorMsg" hidden></div>
</div>

<script>
const shopName = document.getElementById("shopName");
const description = document.getElementById("description");
const logoInput = document.getElementById("logoUpload");
const previewBox = document.getElementById("previewBox");
const btn = document.getElementById("registerBtn");
const successMsg = document.getElementById("successMsg");
const errorMsg = document.getElementById("errorMsg");

let logoBase64 = "";

// -------------------
// LOGO PREVIEW
// -------------------
previewBox.addEventListener("click", () => logoInput.click());

logoInput.addEventListener("change", () => {
    const file = logoInput.files[0];
    if (!file) return;

    if (file.size > 2 * 1024 * 1024) {
        alert("Logo must be under 2MB");
        return;
    }

    const reader = new FileReader();
    reader.onload = () => {
        logoBase64 = reader.result;
        previewBox.innerHTML = `<img src="${logoBase64}">`;
    };
    reader.readAsDataURL(file);
});

// -------------------
// SUBMIT FORM
// -------------------
btn.addEventListener("click", async () => {
    btn.disabled = true;

    if (!shopName.value.trim() || !description.value.trim() || !logoBase64) {
        alert("Please fill all fields and upload a logo");
        btn.disabled = false;
        return;
    }

    const payload = {
        name: shopName.value.trim(),
        description: description.value.trim(),
        logo: logoBase64
    };

    try {
        // Assuming user is logged in and has a JWT stored in localStorage
        const token = localStorage.getItem("token");

        const res = await fetch("https://campus-junction-2.onrender.com", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.message || "Failed to register shop");

        successMsg.textContent = "Shop registered successfully âœ…";
        successMsg.hidden = false;
        errorMsg.hidden = true;

        // Reset form
        shopName.value = "";
        description.value = "";
        previewBox.textContent = "Click to upload Shop Logo";
        logoBase64 = "";

    } catch (err) {
        errorMsg.textContent = err.message || "Server error";
        errorMsg.hidden = false;
        successMsg.hidden = true;
    }

    btn.disabled = false;
});
</script>

</body>
</html>
