<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Junction | Upload Item</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

/* Container */
.container {
  max-width: 500px;
  margin: auto;
  background: #fff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
}

/* Heading */
h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #007bff;
}

/* Input Groups */
.input-group {
  margin-bottom: 15px;
}
label {
  display: block;
  font-weight: bold;
  margin-bottom: 6px;
  color: #333;
}
input, textarea, select {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  outline: none;
  transition: border-color 0.3s;
}
input:focus, textarea:focus, select:focus {
  border-color: #007bff;
}

/* Image preview */
.image-preview {
  width: 100%;
  height: 200px;
  background: #eee;
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  margin-bottom: 15px;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
  position: relative;
}
.image-preview:hover { background: #ddd; transform: scale(1.02); }
.image-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Toggle */
.toggle-group {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}
.toggle {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  cursor: pointer;
}
.toggle input {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

/* Button */
button {
  width: 100%;
  padding: 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background 0.3s;
}
button:hover { background: #005fcc; }

/* Loader inside button */
button .spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #fff;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 1s linear infinite;
  display: none;
}
@keyframes spin { 100% { transform: rotate(360deg); } }

/* Responsive */
@media(max-width:500px){
  .container { padding: 20px; }
  .image-preview { height: 180px; }
}
</style>
</head>

<body>
<form id="form">
  <div class="container">
    <h2>Upload New Item</h2>

    <!-- IMAGE UPLOAD -->
    <div class="image-preview" onclick="document.getElementById('fileUpload').click()">
      <span>Click to select image</span>
    </div>
    <input type="file" id="fileUpload" accept="image/*" style="display:none">

    <!-- ITEM NAME -->
    <div class="input-group">
      <label>Item Name</label>
      <input type="text" id="itemName" placeholder="Enter item name" required>
    </div>

    <!-- ITEM TYPE -->
    <div class="input-group">
      <label>Type</label>
      <input type="text" id="itemType" placeholder="Enter type (e.g., Laptop, Phone)" required>
    </div>

    <!-- PRICE -->
    <div class="input-group">
      <label>Price (Ksh)</label>
      <input type="number" id="itemPrice" placeholder="Enter price" min="1" required>
    </div>

    <!-- DESCRIPTION -->
    <div class="input-group">
      <label>Description</label>
      <textarea id="itemDesc" rows="4" placeholder="Describe the item" required></textarea>
    </div>

    <!-- NEW/USED TOGGLE -->
    <div class="toggle-group">
      <label class="toggle">
        <input type="radio" name="condition" value="new" checked> New
      </label>
      <label class="toggle">
        <input type="radio" name="condition" value="used"> Used
      </label>
    </div>

    <button type="submit">
      <span class="btn-text">Upload Item</span>
      <span class="spinner"></span>
    </button>
  </div>
</form>

<script>
const form = document.getElementById('form');
const fileInput = document.getElementById('fileUpload');
const preview = document.querySelector('.image-preview');
const button = form.querySelector('button');
const btnText = button.querySelector('.btn-text');
const spinner = button.querySelector('.spinner');

let imageBase64 = ''; // Base64 image

// IMAGE PREVIEW + BASE64
fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if (!file) return;

  if(file.size > 2*1024*1024) { // 2MB limit
    alert('Image must be less than 2MB');
    fileInput.value = '';
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    imageBase64 = reader.result;
    preview.innerHTML = `<img src="${imageBase64}" />`;
  };
  reader.readAsDataURL(file);
});

// FORM SUBMIT
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = document.getElementById('itemName').value.trim();
  const type = document.getElementById('itemType').value.trim();
  const price = Number(document.getElementById('itemPrice').value);
  const description = document.getElementById('itemDesc').value.trim();
  const conditionInput = document.querySelector('input[name="condition"]:checked');

  if(!imageBase64 || !name || !type || !price || !description || !conditionInput) {
    alert('❌ Please fill all fields and select an image');
    return;
  }

  const status = conditionInput.value; // 'new' or 'used'

  const product = {
    image: imageBase64,
    name,
    type,
    price,
    description,
    status,
    sellerId: localStorage.getItem('sellerId') || null
  };

  // Show spinner
  spinner.style.display = 'inline-block';
  btnText.style.display = 'none';
  button.disabled = true;

  try {
    const res = await fetch('http://localhost:5000/api/products', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(product)
    });

    const data = await res.json();
    if(!res.ok){
      alert('❌ ' + (data.message || 'Upload failed'));
      return;
    }

    alert('✅ Product uploaded successfully!');
    form.reset();
    preview.innerHTML = '<span>Click to select image</span>';
    imageBase64 = '';

  } catch(err){
    console.error(err);
    alert('❌ Server error');
  } finally {
    spinner.style.display = 'none';
    btnText.style.display = 'inline';
    button.disabled = false;
  }
});
</script>

</body>
</html>
